<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://lfg-site-content.s3.eu-west-2.amazonaws.com/lfg+favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://lfg-site-content.s3.eu-west-2.amazonaws.com/lfg+favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://lfg-site-content.s3.eu-west-2.amazonaws.com/lfg+favicon.png">

  <!-- OpenGraph -->
  <meta property="og:title" content="Dirty Dashboard - Areas Failing to Manage Fly-Tipping">
  <meta property="og:description" content="Interactive map and league table tracking the worst areas in the UK for Fly-Tipping">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Looking For Growth">
  <meta property="og:image" content="https://dashboards.lookingforgrowth.uk/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Dirty Dashboard - Areas Failing to Manage Fly-Tipping">
  <meta name="twitter:description" content="Interactive map and league table tracking the worst areas in the UK for Fly-Tipping">
  <meta name="twitter:image" content="https://dashboards.lookingforgrowth.uk/og-image.png">

  <title>Dirty Dashboard | Looking For Growth</title>

  <!-- Google Fonts: DM Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">

  <!-- Octarine font (LFG brand) -->
  <style>
    @font-face {
      font-family: 'Octarine';
      src: url('https://dashboards.lookingforgrowth.uk/_astro/Octarine-Bold.CR4U0q0x.otf') format('opentype');
      font-weight: 700;
      font-style: normal;
    }
    @font-face {
      font-family: 'Octarine';
      src: url('https://dashboards.lookingforgrowth.uk/_astro/Octarine-Light.uRTgbM2i.otf') format('opentype');
      font-weight: 300;
      font-style: normal;
    }
  </style>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <!-- MapLibre GL -->
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css">
  <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --brand-ocean-blue: #79CAC4;
      --brand-milky-white: #F5F0E8;
      --brand-flashy-orange: #FE5500;
      --brand-grassy-green: #4CB05A;
      --brand-royal-purple: #9B59B6;
      --brand-footer: #283848;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      color: #1a1a1a;
      -webkit-font-smoothing: antialiased;
    }

    .font-octarine { font-family: 'Octarine', sans-serif; }
    .font-dm-sans { font-family: 'DM Sans', sans-serif; }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    .nav-bar {
      position: sticky; top: 0; z-index: 50;
      background: var(--brand-ocean-blue);
      border-bottom: 3px solid #000;
      display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between;
      padding: 1rem; min-height: 80px;
      box-shadow: 0 1px 3px rgba(0,0,0,.1);
    }
    .nav-logo { font-family: 'Octarine', sans-serif; font-weight: 700; font-size: 2.25rem; color: #000; text-decoration: none; padding-top: .25rem; }
    .nav-links { display: flex; flex-wrap: wrap; align-items: center; gap: .5rem; }
    .nav-links a { font-weight: 700; font-size: .875rem; padding: .5rem 1rem; border-radius: .5rem; text-decoration: none; color: #000; }
    .nav-links a:hover { background: rgba(0,0,0,.08); }
    .nav-links .donate-btn {
      background: #FBBF24; border-radius: 9999px; color: #000; font-weight: 700;
      padding: .5rem 1rem; transition: background .3s;
    }
    .nav-links .donate-btn:hover { background: #F59E0B; }

    /* Mobile nav */
    .nav-hamburger { display: none; background: none; border: none; cursor: pointer; font-size: 1.5rem; }
    @media (max-width: 1023px) {
      .nav-links { display: none; }
      .nav-hamburger { display: block; position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); }
      .nav-links.open { display: flex; flex-direction: column; width: 100%; margin-top: 1rem; }
    }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      background: var(--brand-milky-white);
      border-bottom: 2px solid #000;
      display: flex; align-items: center; justify-content: center;
      padding: 3rem 1.5rem; min-height: 40vh;
    }
    .hero h1 { text-align: center; font-family: 'Octarine', sans-serif; font-weight: 800; font-size: 2rem; text-transform: uppercase; }
    @media (min-width: 768px) { .hero h1 { font-size: 3rem; } }

    /* ‚îÄ‚îÄ SECTIONS ‚îÄ‚îÄ */
    .section { max-width: 64rem; width: 100%; margin: 0 auto; padding: 2rem 2rem; }
    .section.wide { max-width: 72rem; }
    .section-intro { display: flex; flex-direction: column; gap: 2.5rem; text-align: center; margin-top: 2.5rem; padding-bottom: 4rem; }
    .section-intro h2 { font-family: 'Octarine', sans-serif; font-weight: 700; font-size: 2rem; }
    @media (min-width: 768px) { .section-intro h2 { font-size: 2.25rem; } }
    .section-intro .desc { display: flex; flex-direction: column; gap: 2rem; font-size: 1.125rem; font-weight: 300; line-height: 1.7; }
    @media (min-width: 768px) { .section-intro .desc { font-size: 1.5rem; } }

    /* ‚îÄ‚îÄ NEWSLETTER FORM ‚îÄ‚îÄ */
    .newsletter-form {
      background: #fff; border-radius: .75rem; padding: 2rem; display: flex; flex-direction: column; gap: 1.25rem;
      box-shadow: 0 10px 25px rgba(0,0,0,.1); border: 2px solid #000; max-width: 28rem; width: 100%; margin: 0 auto;
    }
    .newsletter-form label { font-size: .875rem; font-weight: 500; }
    .newsletter-form input[type="text"],
    .newsletter-form input[type="email"] {
      width: 100%; height: 2.25rem; border: 1px solid #d1d5db; border-radius: .375rem;
      padding: .25rem .75rem; font-size: 1rem; outline: none; transition: border-color .2s, box-shadow .2s;
    }
    .newsletter-form input:focus { border-color: var(--brand-ocean-blue); box-shadow: 0 0 0 3px rgba(121,202,196,.3); }
    .newsletter-form button {
      background: #000; color: #fff; font-weight: 700; padding: .625rem 1.5rem; border-radius: 8px; border: none; cursor: pointer;
      border-top: 2px solid var(--brand-flashy-orange);
      border-bottom: 6px solid var(--brand-flashy-orange);
      border-left: 2px solid var(--brand-flashy-orange);
      border-right: 6px solid var(--brand-flashy-orange);
      transition: all .2s;
    }
    .newsletter-form button:hover { background: var(--brand-flashy-orange); color: #000; border-color: #000; }

    /* ‚îÄ‚îÄ LEAGUE TABLE ‚îÄ‚îÄ */
    .league-table-wrapper {
      background: #fff; border-radius: .75rem; border: 2px solid #000;
      box-shadow: 0 10px 25px rgba(0,0,0,.1); overflow: hidden;
    }
    .table-header {
      background: var(--brand-ocean-blue); color: #fff; font-family: 'Octarine', sans-serif; font-weight: 700;
      display: grid; grid-template-columns: 1fr 5fr 3fr 3fr 2fr; gap: 1rem; padding: 1rem;
      font-size: .875rem;
    }
    @media (min-width: 768px) {
      .table-header { grid-template-columns: 1fr 5fr 2fr 3fr 3fr 2fr; font-size: 1rem; }
    }
    .table-header > div { display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: .25rem; padding: .25rem .5rem; text-align: center; }
    .table-header > div:hover { background: rgba(255,255,255,.15); }
    .table-header .col-name { justify-content: flex-start; }
    .table-header .col-total { display: none; }
    @media (min-width: 768px) { .table-header .col-total { display: flex; } }

    .table-row {
      display: grid; grid-template-columns: 1fr 5fr 3fr 3fr 2fr; gap: 1rem; padding: 1rem;
      border-bottom: 1px solid #e5e7eb; transition: background .2s;
    }
    @media (min-width: 768px) {
      .table-row { grid-template-columns: 1fr 5fr 2fr 3fr 3fr 2fr; }
    }
    .table-row:hover { background: #f9fafb; }
    .table-row > div { display: flex; align-items: center; justify-content: center; text-align: center; }
    .table-row .col-name { justify-content: flex-start; }
    .table-row .col-total { display: none; }
    @media (min-width: 768px) { .table-row .col-total { display: flex; } }

    .table-row .rank { font-weight: 700; }
    .table-row .authority-name { font-weight: 600; color: #111827; }
    .table-row .authority-code { font-size: .75rem; color: #6b7280; }
    .table-row .stat-value { font-weight: 700; }
    .table-row .stat-label { font-size: .625rem; color: #6b7280; }
    @media (min-width: 768px) { .table-row .stat-label { font-size: .75rem; } }

    .table-footer { background: #f9fafb; padding: 1rem; text-align: center; font-size: .875rem; color: #4b5563; border-top: 1px solid #e5e7eb; }
    .table-footer button {
      margin-top: .5rem; padding: .5rem 1rem; background: var(--brand-ocean-blue); color: #fff;
      border: none; border-radius: .5rem; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600;
      transition: opacity .2s;
    }
    .table-footer button:hover { opacity: .9; }

    /* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
    .search-input {
      width: 100%; padding: .75rem 1rem; border: 2px solid #d1d5db; border-radius: .5rem;
      font-family: 'DM Sans', sans-serif; font-size: 1rem; outline: none; transition: border-color .2s;
      margin-bottom: 1rem;
    }
    .search-input:focus { border-color: var(--brand-ocean-blue); }

    /* ‚îÄ‚îÄ STATS CARDS ‚îÄ‚îÄ */
    .stats-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; margin-top: 1.5rem; }
    @media (min-width: 768px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1024px) { .stats-grid { grid-template-columns: repeat(4, 1fr); } }
    .stat-card {
      background: #fff; padding: 1rem 1.5rem; border-radius: .5rem; border: 2px solid #000;
      box-shadow: 0 4px 10px rgba(0,0,0,.1); text-align: center; min-height: 6rem;
      display: flex; flex-direction: column; justify-content: center;
    }
    .stat-card .stat-big { font-family: 'Octarine', sans-serif; font-weight: 700; font-size: 1.25rem; }
    @media (min-width: 1024px) { .stat-card .stat-big { font-size: 1.5rem; } }
    .stat-card .stat-desc { font-size: .875rem; color: #4b5563; }

    /* ‚îÄ‚îÄ METHODOLOGY NOTE ‚îÄ‚îÄ */
    .methodology {
      margin-top: 1.5rem; background: #f9fafb; padding: 1.5rem; border-radius: .5rem;
      border: 1px solid #e5e7eb; font-size: .875rem; color: #374151; line-height: 1.7;
    }
    .methodology p { margin-bottom: .75rem; }
    .methodology p:last-child { margin-bottom: 0; }
    .methodology a { color: #2563eb; text-decoration: underline; }
    .methodology a:hover { color: #1e40af; }

    /* ‚îÄ‚îÄ MAP ‚îÄ‚îÄ */
    .map-section { text-align: center; }
    .map-section h2 { font-family: 'Octarine', sans-serif; font-weight: 700; font-size: 1.5rem; margin-bottom: .5rem; }
    @media (min-width: 768px) { .map-section h2 { font-size: 2rem; } }
    .map-section .subtitle { font-size: 1.125rem; margin-bottom: .5rem; }
    .map-section .click-hint { font-weight: 700; font-size: .875rem; }
    @media (min-width: 768px) { .map-section .click-hint { font-size: 1rem; } }
    #map-container { width: 100%; min-height: 500px; border-radius: .5rem; overflow: hidden; border: 2px solid #e5e7eb; margin-top: 1rem; position: relative; }
    .map-placeholder {
      display: flex; align-items: center; justify-content: center; min-height: 500px;
      background: #f1f5f9; color: #64748b; font-size: 1.125rem; font-weight: 500;
    }
    #map { width: 100%; height: 600px; }
    .map-popup { font-family: 'DM Sans', sans-serif; padding: .25rem; }
    .map-popup h4 { font-family: 'Octarine', sans-serif; font-weight: 700; font-size: 1rem; margin-bottom: .25rem; }
    .map-popup .code { font-size: .75rem; color: #6b7280; }
    .map-popup .stats { margin-top: .5rem; font-size: .875rem; }
    .map-popup .stats div { margin-bottom: .25rem; }
    .map-legend {
      position: absolute; bottom: 2rem; right: 1rem; background: rgba(255,255,255,.95);
      padding: .75rem 1rem; border-radius: .5rem; font-size: .75rem; z-index: 5;
      box-shadow: 0 2px 8px rgba(0,0,0,.15); border: 1px solid #e5e7eb;
    }
    .map-legend h4 { font-weight: 700; margin-bottom: .5rem; font-size: .8rem; }
    .map-legend .legend-item { display: flex; align-items: center; gap: .5rem; margin-bottom: .25rem; }
    .map-legend .legend-swatch { width: 16px; height: 16px; border-radius: 2px; border: 1px solid #ccc; }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    .site-footer {
      background: var(--brand-footer); color: #fff; padding: 3rem 1.5rem; margin-top: auto;
    }
    .footer-grid {
      display: grid; grid-template-columns: 1fr; gap: 2rem; text-align: center; align-items: center;
    }
    @media (min-width: 768px) {
      .footer-grid { grid-template-columns: repeat(3, 1fr); text-align: left; }
      .footer-center { text-align: center; }
      .footer-right { display: flex; gap: 1rem; justify-content: flex-end; }
    }
    .footer-social { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; }
    .footer-social a { color: #fff; transition: color .2s; text-decoration: none; }
    .footer-social a:hover { color: #d1d5db; }
    .footer-right a { color: #fff; text-decoration: underline; }

    /* ‚îÄ‚îÄ SORT ARROWS ‚îÄ‚îÄ */
    .sort-icon { width: 16px; height: 16px; margin-left: 4px; flex-shrink: 0; }

    /* ‚îÄ‚îÄ LOADING SKELETON ‚îÄ‚îÄ */
    .skeleton-row { animation: pulse 1.5s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .4; } }

    /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
    .empty-state {
      padding: 4rem 2rem; text-align: center; color: #6b7280;
    }
    .empty-state .icon { font-size: 3rem; margin-bottom: 1rem; }
    .empty-state h3 { font-family: 'Octarine', sans-serif; font-size: 1.5rem; font-weight: 700; color: #374151; margin-bottom: .5rem; }
    .empty-state p { font-size: 1rem; }
  </style>
</head>
<body>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <nav class="nav-bar">
    <a href="https://lookingforgrowth.uk" class="nav-logo">LFG</a>
    <button class="nav-hamburger" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="nav-links">
      <a href="https://lookingforgrowth.uk/student-loan-calculator.html">Student Loan Calculator</a>
      <a href="https://lookingforgrowth.uk/youth-unemployment-dashboard.html">Youth Unemployment</a>
      <a href="https://dashboards.lookingforgrowth.uk/dashboards/opinion-tracker">Opinion Tracker</a>
      <a href="https://dashboards.lookingforgrowth.uk/dashboards/energy-costs/">Energy Costs</a>
      <a href="https://dashboards.lookingforgrowth.uk/dashboards/state-of-the-nation">State of the Nation</a>
      <a href="https://dashboards.lookingforgrowth.uk/dashboards/no-more-delays/">No More Delays</a>
      <a href="https://dashboards.lookingforgrowth.uk/dashboards/planning-applications/admin-ongoing/">Planning Applications</a>
      <a href="#">Dirty Dashboard</a>
      <a href="https://merch.lookingforgrowth.uk/" target="_blank" rel="noopener noreferrer">Merch</a>
      <a href="https://lookingforgrowth.uk/donate" class="donate-btn">donate</a>
    </div>
  </nav>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="hero">
    <h1>The Dirty Dashboard</h1>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INTRO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section section-intro">
    <h2 class="font-octarine">UK streets are plagued with RAMPANT FLY TIPPING which never gets resolved</h2>
    <div class="desc">
      <p>local authorities are responsible for investigating fly-tipping</p>
      <p>but many areas have 10,000s of cases and solution rates close to 0%</p>
      <p>it doesn't have to be this way, and local authorities should be made to ACT</p>
    </div>

    <!-- Newsletter 1 -->
    <div style="display:flex;flex-direction:column;align-items:center;gap:1rem;max-width:28rem;margin:0 auto;width:100%;">
      <h3 class="font-octarine" style="font-weight:700;font-size:1.5rem;">Stay updated</h3>
      <form class="newsletter-form" id="newsletter-form-1" onsubmit="return handleNewsletter(event, this)">
        <div style="display:flex;flex-direction:column;gap:.5rem;">
          <label>first name*</label>
          <input type="text" name="firstName" required>
        </div>
        <div style="display:flex;flex-direction:column;gap:.5rem;">
          <label>email*</label>
          <input type="email" name="email" required>
        </div>
        <button type="submit">join the mailing list</button>
      </form>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LEAGUE TABLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section">
    <div style="display:flex;flex-direction:column;gap:2.5rem;">
      <h2 class="font-octarine" style="font-weight:700;font-size:2rem;text-align:center;">fly-tipping league table</h2>
      <p style="text-align:center;font-size:1.125rem;font-weight:300;line-height:1.7;">Top 20 local authorities by investigation success</p>

      <!-- Search -->
      <input type="text" class="search-input" id="search-input" placeholder="Search for your local authority..." oninput="handleSearch(this.value)">

      <!-- Table -->
      <div class="league-table-wrapper">
        <div class="table-header" id="table-header">
          <div onclick="sortTable('rank')">#</div>
          <div class="col-name" onclick="sortTable('authority')"><span>Local Authority</span><span class="sort-icon" id="sort-authority"></span></div>
          <div class="col-total" onclick="sortTable('totalCases')"><span>Total Cases</span><span class="sort-icon" id="sort-totalCases"></span></div>
          <div onclick="sortTable('unresolvedCases')"><span>Unresolved<br>Cases</span><span class="sort-icon" id="sort-unresolvedCases"></span></div>
          <div onclick="sortTable('penaltyRate')"><span>Penalty Rate (FPNs)</span><span class="sort-icon" id="sort-penaltyRate"></span></div>
          <div onclick="sortTable('prosecutionRate')"><span>Prosecution Rate</span><span class="sort-icon" id="sort-prosecutionRate"></span></div>
        </div>
        <div id="table-body">
          <!-- Rows rendered by JS -->
          <div class="empty-state">
            <div class="icon">üìä</div>
            <h3>Data Loading Soon</h3>
            <p>New data will be available when the spreadsheet is connected.<br>Check back at 9:30 AM on release day.</p>
          </div>
        </div>
        <div class="table-footer" id="table-footer" style="display:none;">
          <p>Click column headers to sort &bull; Showing top <span id="showing-count">20</span> local authorities</p>
          <button onclick="showMore()">Show next 20</button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="stats-grid" id="stats-grid">
        <div class="stat-card">
          <div class="stat-big" style="color:#dc2626;" id="stat-poor">‚Äî</div>
          <div class="stat-desc">Poor or Worse Performers (&lt;25%)</div>
        </div>
        <div class="stat-card">
          <div class="stat-big" style="color:#2563eb;" id="stat-avg-resolution">‚Äî</div>
          <div class="stat-desc">Average Resolution Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-big" style="color:#7c3aed;" id="stat-total-cases">‚Äî</div>
          <div class="stat-desc">Total Cases Tracked</div>
        </div>
        <div class="stat-card">
          <div class="stat-big" style="color:#ea580c;" id="stat-avg-prosecution">‚Äî</div>
          <div class="stat-desc">Average Prosecution Rate</div>
        </div>
      </div>

      <!-- Methodology -->
      <div class="methodology">
        <p>Our dashboard shows you how bad your local area is for punishing fly tippers. We got this data from the Government and it runs from April 2023 to March 2024. We copied the LA_Incidents to LA_Actions and calculated the percentages from FPNs and prosecutions.</p>
        <p>A 'resolved case' is defined as an incident which resulted in either a Fixed Penalty Notice, or a prosecution.</p>
        <p>In the <a href="https://assets.publishing.service.gov.uk/media/67bc9262ff9676313f353489/Flytipping_incidents_and_actions_taken__reported_by_LAs_in_England__2012-13_to_2023-24.ods" target="_blank" rel="noopener noreferrer">official Government statistics</a>, the "resolution rate" is far higher. This is because they class an "investigation" as an action - even if it goes nowhere.</p>
        <p>A Fixed Penalty Notice is a mechanism from the Government to allow someone to avoid prosecution and discharge their liability through paying a fine.</p>
        <p>Anything highlighted in purple is a suspicious value. This could be due to several factors, such as multiple offenders being involved in a single fly-tipping incident, or reporting issues.</p>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NEWSLETTER 2 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section" style="padding-bottom:3rem;">
    <div style="display:flex;flex-direction:column;align-items:center;gap:1rem;max-width:28rem;margin:0 auto;width:100%;">
      <h3 class="font-octarine" style="font-weight:700;font-size:1.5rem;text-align:center;">Find out how you can help</h3>
      <form class="newsletter-form" id="newsletter-form-2" onsubmit="return handleNewsletter(event, this)">
        <div style="display:flex;flex-direction:column;gap:.5rem;">
          <label>first name*</label>
          <input type="text" name="firstName" required>
        </div>
        <div style="display:flex;flex-direction:column;gap:.5rem;">
          <label>email*</label>
          <input type="email" name="email" required>
        </div>
        <button type="submit">join the mailing list</button>
      </form>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section" style="padding-top:1rem;padding-bottom:2.5rem;">
    <div class="map-section">
      <h2>fly-tipping map</h2>
      <p class="subtitle">explore fly-tipping solve rates across UK local authorities</p>
      <p class="click-hint">click regions for more information</p>
      <div id="map-container">
        <div id="map"></div>
        <div class="map-legend">
          <h4>Solve Rate (FPN + Prosecution)</h4>
          <div class="legend-item"><div class="legend-swatch" style="background:#7f1d1d"></div> 0-5% Disgraceful</div>
          <div class="legend-item"><div class="legend-swatch" style="background:#dc2626"></div> 5-10% Very Poor</div>
          <div class="legend-item"><div class="legend-swatch" style="background:#f97316"></div> 10-20% Poor</div>
          <div class="legend-item"><div class="legend-swatch" style="background:#eab308"></div> 20-40% Below Average</div>
          <div class="legend-item"><div class="legend-swatch" style="background:#3b82f6"></div> 40-60% Average</div>
          <div class="legend-item"><div class="legend-swatch" style="background:#16a34a"></div> 60%+ Good</div>
          <div class="legend-item"><div class="legend-swatch" style="background:#d1d5db"></div> No data</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NEWSLETTER 3 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section" style="padding-top:2rem;padding-bottom:4rem;">
    <div style="display:flex;flex-direction:column;align-items:center;gap:2rem;">
      <div style="text-align:center;">
        <h2 class="font-octarine" style="font-weight:700;font-size:2rem;margin-bottom:1rem;">stay informed</h2>
        <p style="font-size:1.125rem;font-weight:300;">get updates on fly-tipping and our other campaigns</p>
      </div>
      <div style="max-width:28rem;width:100%;">
        <form class="newsletter-form" id="newsletter-form-3" onsubmit="return handleNewsletter(event, this)">
          <div style="display:flex;flex-direction:column;gap:.5rem;">
            <label>first name*</label>
            <input type="text" name="firstName" required>
          </div>
          <div style="display:flex;flex-direction:column;gap:.5rem;">
            <label>email*</label>
            <input type="email" name="email" required>
          </div>
          <button type="submit">join the mailing list</button>
        </form>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <footer class="site-footer">
    <div class="footer-grid" style="max-width:72rem;margin:0 auto;">
      <div>
        <div>Something Completely Different Limited</div>
        <div>For enquiries and concerns</div>
        <div>hello@lookingforgrowth.uk</div>
      </div>
      <div class="footer-center">
        <div>For Press Enquiries</div>
        <div>press@lookingforgrowth.uk</div>
        <div class="footer-social">
          <a href="https://www.linkedin.com/company/lfg-uk" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"/></svg>
          </a>
          <a href="https://www.tiktok.com/@looking.for.growth" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89 2.84 2.84 0 01.89.14V9.02a6.25 6.25 0 00-1-.05A6.34 6.34 0 003 15.31a6.34 6.34 0 006.38 6.33 6.34 6.34 0 006.38-6.33V9.19a8.16 8.16 0 004.83 1.56V7.3a4.85 4.85 0 01-1-.61z"/></svg>
          </a>
          <a href="https://x.com/lfg_uk" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          </a>
          <a href="https://www.facebook.com/lookingforgrowth/" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
          </a>
          <a href="https://www.instagram.com/lookingforgrowthuk/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
          </a>
        </div>
      </div>
      <div class="footer-right" style="display:flex;flex-direction:column;gap:1rem;">
        <a download href="https://lfg-site-content.s3.eu-west-2.amazonaws.com/Privacy+Policy.pdf">Privacy Policy</a>
        <a download href="https://lfg-site-content.s3.eu-west-2.amazonaws.com/Cookies+Policy.pdf">Cookie Policy</a>
      </div>
    </div>
  </footer>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JAVASCRIPT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    // DATA SOURCE
    // Replace this empty array with your spreadsheet data.
    // Each object should have these fields:
    //   authority, code, totalCases, unresolvedCases,
    //   penaltyRate, prosecutionRate
    //
    // Example:
    //   { authority: "Croydon", code: "E09000008", totalCases: 35470,
    //     unresolvedCases: 35462, penaltyRate: 0.0, prosecutionRate: 0.0 }
    //
    // To connect to a Google Sheet:
    //   1. Publish the sheet as CSV
    //   2. Fetch & parse it in loadSpreadsheetData() below
    // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

    let ALL_DATA = [];

    // ‚îÄ‚îÄ Spreadsheet loader (update URL when ready) ‚îÄ‚îÄ
    const SPREADSHEET_CSV_URL = ''; // e.g. 'https://docs.google.com/spreadsheets/d/XXXXX/export?format=csv'

    async function loadSpreadsheetData() {
      if (!SPREADSHEET_CSV_URL) return;
      try {
        const res = await fetch(SPREADSHEET_CSV_URL);
        const text = await res.text();
        const rows = text.trim().split('\n').map(r => r.split(','));
        const headers = rows[0];
        ALL_DATA = rows.slice(1).map(row => {
          const obj = {};
          headers.forEach((h, i) => { obj[h.trim()] = row[i] ? row[i].trim() : ''; });
          return {
            authority: obj['authority'] || obj['Local Authority'] || obj['la_name'] || '',
            code: obj['code'] || obj['la_code'] || obj['ONS Code'] || '',
            totalCases: parseFloat(obj['totalCases'] || obj['total_cases'] || obj['Total Incidents'] || 0),
            unresolvedCases: parseFloat(obj['unresolvedCases'] || obj['unresolved_cases'] || obj['Unresolved'] || 0),
            penaltyRate: parseFloat(obj['penaltyRate'] || obj['penalty_rate'] || obj['FPN Rate'] || 0),
            prosecutionRate: parseFloat(obj['prosecutionRate'] || obj['prosecution_rate'] || obj['Prosecution Rate'] || 0),
          };
        }).filter(d => d.authority);
        initDashboard();
      } catch (e) {
        console.error('Failed to load spreadsheet:', e);
      }
    }

    // ‚îÄ‚îÄ State ‚îÄ‚îÄ
    let currentSort = { key: 'unresolvedCases', dir: 'desc' };
    let pageSize = 20;
    let currentPage = 1;
    let searchTerm = '';

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
    function formatNumber(n) {
      return n.toLocaleString('en-GB');
    }

    function getRating(value, type) {
      if (type === 'penalty') {
        if (value <= 5) return { label: 'Disgraceful', color: '#7f1d1d' };
        if (value <= 10) return { label: 'Very Poor', color: '#dc2626' };
        if (value <= 20) return { label: 'Poor', color: '#f97316' };
        if (value <= 40) return { label: 'Below Average', color: '#eab308' };
        if (value <= 60) return { label: 'Average', color: '#3b82f6' };
        return { label: 'Good', color: '#16a34a' };
      }
      // prosecution
      if (value <= 0.05) return { label: 'Disgraceful', color: '#7f1d1d' };
      if (value <= 0.2) return { label: 'Very Poor', color: '#dc2626' };
      if (value <= 0.5) return { label: 'Poor', color: '#f97316' };
      if (value <= 1) return { label: 'Below Average', color: '#eab308' };
      if (value <= 3) return { label: 'Average', color: '#3b82f6' };
      return { label: 'Good', color: '#16a34a' };
    }

    function getUnresolvedColor(total, unresolved) {
      const pct = total > 0 ? (unresolved / total) * 100 : 0;
      if (pct >= 80) return '#dc2626';
      if (pct >= 60) return '#f97316';
      if (pct >= 40) return '#eab308';
      return '#16a34a';
    }

    // ‚îÄ‚îÄ Sort ‚îÄ‚îÄ
    function sortTable(key) {
      if (currentSort.key === key) {
        currentSort.dir = currentSort.dir === 'desc' ? 'asc' : 'desc';
      } else {
        currentSort = { key, dir: key === 'authority' ? 'asc' : 'desc' };
      }
      currentPage = 1;
      renderTable();
    }

    function getSortedData() {
      let data = [...ALL_DATA];
      if (searchTerm) {
        const q = searchTerm.toLowerCase();
        data = data.filter(d => d.authority.toLowerCase().includes(q) || d.code.toLowerCase().includes(q));
      }
      const { key, dir } = currentSort;
      data.sort((a, b) => {
        let va = a[key], vb = b[key];
        if (typeof va === 'string') { va = va.toLowerCase(); vb = vb.toLowerCase(); }
        if (va < vb) return dir === 'asc' ? -1 : 1;
        if (va > vb) return dir === 'asc' ? 1 : -1;
        return 0;
      });
      // Add rank
      data.forEach((d, i) => { d.rank = i + 1; });
      return data;
    }

    // ‚îÄ‚îÄ Render ‚îÄ‚îÄ
    function renderTable() {
      const body = document.getElementById('table-body');
      const footer = document.getElementById('table-footer');
      const sorted = getSortedData();
      const visible = sorted.slice(0, currentPage * pageSize);

      if (ALL_DATA.length === 0) {
        body.innerHTML = `
          <div class="empty-state">
            <div class="icon">üìä</div>
            <h3>Data Loading Soon</h3>
            <p>New data will be available when the spreadsheet is connected.<br>Check back at 9:30 AM on release day.</p>
          </div>`;
        footer.style.display = 'none';
        return;
      }

      if (sorted.length === 0) {
        body.innerHTML = `
          <div class="empty-state">
            <div class="icon">üîç</div>
            <h3>No results found</h3>
            <p>Try a different search term</p>
          </div>`;
        footer.style.display = 'none';
        return;
      }

      let html = '';
      visible.forEach(d => {
        const penaltyRating = getRating(d.penaltyRate, 'penalty');
        const prosecutionRating = getRating(d.prosecutionRate, 'prosecution');
        const unresolvedColor = getUnresolvedColor(d.totalCases, d.unresolvedCases);

        html += `
          <div class="table-row">
            <div class="rank">${d.rank}</div>
            <div class="col-name">
              <div>
                <div class="authority-name">${d.authority}</div>
                <div class="authority-code">${d.code}</div>
              </div>
            </div>
            <div class="col-total">
              <div>
                <div class="stat-value">${formatNumber(d.totalCases)}</div>
                <div class="stat-label">total</div>
              </div>
            </div>
            <div>
              <div>
                <div class="stat-value" style="color:${unresolvedColor}">${formatNumber(d.unresolvedCases)}</div>
                <div class="stat-label">unresolved</div>
              </div>
            </div>
            <div>
              <div>
                <div class="stat-value" style="color:${penaltyRating.color}">${d.penaltyRate.toFixed(1)}%</div>
                <div class="stat-label">${penaltyRating.label}</div>
              </div>
            </div>
            <div>
              <div>
                <div class="stat-value" style="color:${prosecutionRating.color}">${d.prosecutionRate.toFixed(2)}%</div>
                <div class="stat-label">${prosecutionRating.label}</div>
              </div>
            </div>
          </div>`;
      });

      body.innerHTML = html;

      document.getElementById('showing-count').textContent = Math.min(visible.length, sorted.length);
      footer.style.display = visible.length < sorted.length ? 'block' : 'block';
      footer.querySelector('button').style.display = visible.length < sorted.length ? 'inline-block' : 'none';

      // Update sort arrows
      ['authority','totalCases','unresolvedCases','penaltyRate','prosecutionRate'].forEach(k => {
        const el = document.getElementById('sort-' + k);
        if (el) {
          if (currentSort.key === k) {
            el.innerHTML = currentSort.dir === 'desc' ? '&#9660;' : '&#9650;';
          } else {
            el.innerHTML = '';
          }
        }
      });
    }

    function showMore() {
      currentPage++;
      renderTable();
    }

    function handleSearch(value) {
      searchTerm = value;
      currentPage = 1;
      renderTable();
    }

    // ‚îÄ‚îÄ Stats ‚îÄ‚îÄ
    function updateStats() {
      if (ALL_DATA.length === 0) return;

      const totalCases = ALL_DATA.reduce((s, d) => s + d.totalCases, 0);
      const avgPenalty = ALL_DATA.reduce((s, d) => s + d.penaltyRate, 0) / ALL_DATA.length;
      const avgProsecution = ALL_DATA.reduce((s, d) => s + d.prosecutionRate, 0) / ALL_DATA.length;
      const poorCount = ALL_DATA.filter(d => d.penaltyRate < 25).length;
      const poorPct = Math.round((poorCount / ALL_DATA.length) * 100);

      document.getElementById('stat-poor').textContent = poorPct + '% of Councils';
      document.getElementById('stat-avg-resolution').textContent = Math.round(avgPenalty) + '%';
      document.getElementById('stat-total-cases').textContent = formatNumber(totalCases);
      document.getElementById('stat-avg-prosecution').textContent = avgProsecution.toFixed(2) + '%';
    }

    // ‚îÄ‚îÄ Newsletter (Zapier) ‚îÄ‚îÄ
    function handleNewsletter(e, form) {
      e.preventDefault();
      const firstName = form.querySelector('input[name="firstName"]').value;
      const email = form.querySelector('input[name="email"]').value;

      // TODO: Replace with your Zapier webhook URL
      const WEBHOOK_URL = '';

      if (!WEBHOOK_URL) {
        alert('Newsletter signup coming soon!');
        return false;
      }

      fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ firstName, email, listId: 56 })
      })
      .then(() => {
        form.innerHTML = '<p style="text-align:center;font-weight:700;color:#16a34a;padding:1rem;">Thanks for signing up! üéâ</p>';
      })
      .catch(() => {
        alert('Something went wrong. Please try again.');
      });

      return false;
    }

    // ‚îÄ‚îÄ Map ‚îÄ‚îÄ
    let map = null;

    function initMap() {
      map = new maplibregl.Map({
        container: 'map',
        style: {
          version: 8,
          sources: {
            'osm-tiles': {
              type: 'raster',
              tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
              tileSize: 256,
              attribution: '&copy; OpenStreetMap contributors'
            }
          },
          layers: [{
            id: 'osm-tiles',
            type: 'raster',
            source: 'osm-tiles',
            minzoom: 0,
            maxzoom: 19
          }]
        },
        center: [-1.5, 52.8],
        zoom: 5.5,
        maxBounds: [[-12, 49], [5, 57]]
      });

      map.addControl(new maplibregl.NavigationControl(), 'top-left');

      map.on('load', () => {
        fetch('england-la.geojson')
          .then(r => r.json())
          .then(geojson => {
            // Attach data to features if available
            if (ALL_DATA.length > 0) {
              const dataMap = {};
              ALL_DATA.forEach(d => { dataMap[d.code] = d; });
              geojson.features.forEach(f => {
                const code = f.properties.LAD24CD;
                const d = dataMap[code];
                if (d) {
                  f.properties.totalCases = d.totalCases;
                  f.properties.unresolvedCases = d.unresolvedCases;
                  f.properties.penaltyRate = d.penaltyRate;
                  f.properties.prosecutionRate = d.prosecutionRate;
                  f.properties.solveRate = d.penaltyRate + d.prosecutionRate;
                  f.properties.hasData = true;
                } else {
                  f.properties.hasData = false;
                  f.properties.solveRate = -1;
                }
              });
            } else {
              geojson.features.forEach(f => {
                f.properties.hasData = false;
                f.properties.solveRate = -1;
              });
            }

            map.addSource('la-boundaries', { type: 'geojson', data: geojson });

            // Fill layer with color based on solve rate
            map.addLayer({
              id: 'la-fill',
              type: 'fill',
              source: 'la-boundaries',
              paint: {
                'fill-color': [
                  'case',
                  ['==', ['get', 'hasData'], false], '#d1d5db',
                  ['<', ['get', 'solveRate'], 5], '#7f1d1d',
                  ['<', ['get', 'solveRate'], 10], '#dc2626',
                  ['<', ['get', 'solveRate'], 20], '#f97316',
                  ['<', ['get', 'solveRate'], 40], '#eab308',
                  ['<', ['get', 'solveRate'], 60], '#3b82f6',
                  '#16a34a'
                ],
                'fill-opacity': 0.6
              }
            });

            // Border layer
            map.addLayer({
              id: 'la-border',
              type: 'line',
              source: 'la-boundaries',
              paint: {
                'line-color': '#374151',
                'line-width': 0.5
              }
            });

            // Hover effect
            map.addLayer({
              id: 'la-hover',
              type: 'fill',
              source: 'la-boundaries',
              paint: {
                'fill-color': '#000',
                'fill-opacity': 0
              }
            });

            let hoveredId = null;

            map.on('mousemove', 'la-fill', (e) => {
              map.getCanvas().style.cursor = 'pointer';
              if (e.features.length > 0) {
                if (hoveredId !== null) {
                  map.setFeatureState({ source: 'la-boundaries', id: hoveredId }, { hover: false });
                }
                hoveredId = e.features[0].id;
                map.setFeatureState({ source: 'la-boundaries', id: hoveredId }, { hover: true });
              }
            });

            map.on('mouseleave', 'la-fill', () => {
              map.getCanvas().style.cursor = '';
              if (hoveredId !== null) {
                map.setFeatureState({ source: 'la-boundaries', id: hoveredId }, { hover: false });
                hoveredId = null;
              }
            });

            // Popup on click
            map.on('click', 'la-fill', (e) => {
              if (!e.features.length) return;
              const props = e.features[0].properties;
              let content = `<div class="map-popup">
                <h4>${props.LAD24NM}</h4>
                <div class="code">${props.LAD24CD}</div>`;

              if (props.hasData === true || props.hasData === 'true') {
                content += `<div class="stats">
                  <div><strong>Total Cases:</strong> ${formatNumber(props.totalCases)}</div>
                  <div><strong>Unresolved:</strong> ${formatNumber(props.unresolvedCases)}</div>
                  <div><strong>Penalty Rate:</strong> ${parseFloat(props.penaltyRate).toFixed(1)}%</div>
                  <div><strong>Prosecution Rate:</strong> ${parseFloat(props.prosecutionRate).toFixed(2)}%</div>
                </div>`;
              } else {
                content += `<div class="stats"><div style="color:#6b7280;">No data available yet</div></div>`;
              }
              content += '</div>';

              new maplibregl.Popup({ maxWidth: '300px' })
                .setLngLat(e.lngLat)
                .setHTML(content)
                .addTo(map);
            });
          })
          .catch(err => {
            console.error('Failed to load GeoJSON:', err);
            document.getElementById('map').innerHTML = '<div class="map-placeholder">Failed to load map data</div>';
          });
      });
    }

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    function initDashboard() {
      renderTable();
      updateStats();
      // Re-color map if it's already loaded
      if (map && map.getSource('la-boundaries')) {
        updateMapColors();
      }
    }

    function updateMapColors() {
      if (!map || !map.getSource('la-boundaries')) return;
      const source = map.getSource('la-boundaries');
      // Re-fetch and re-color
      fetch('england-la.geojson')
        .then(r => r.json())
        .then(geojson => {
          const dataMap = {};
          ALL_DATA.forEach(d => { dataMap[d.code] = d; });
          geojson.features.forEach(f => {
            const code = f.properties.LAD24CD;
            const d = dataMap[code];
            if (d) {
              f.properties.totalCases = d.totalCases;
              f.properties.unresolvedCases = d.unresolvedCases;
              f.properties.penaltyRate = d.penaltyRate;
              f.properties.prosecutionRate = d.prosecutionRate;
              f.properties.solveRate = d.penaltyRate + d.prosecutionRate;
              f.properties.hasData = true;
            } else {
              f.properties.hasData = false;
              f.properties.solveRate = -1;
            }
          });
          source.setData(geojson);
        });
    }

    // Load data on page ready
    document.addEventListener('DOMContentLoaded', () => {
      initMap();
      loadSpreadsheetData();
      // If no spreadsheet URL, table shows empty state by default
      if (!SPREADSHEET_CSV_URL) {
        renderTable();
      }
    });
  </script>

</body>
</html>
